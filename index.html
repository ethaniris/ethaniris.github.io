<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
  const LIFF_ID = "2008383838-vLABV8zo";
  (async () => {
    const here = location.href;
    const p = new URL(here).searchParams;
    const shareUrl = p.get("url"); // 這就是 /r?ref=...
    await liff.init({ liffId: LIFF_ID });
    if (!liff.isLoggedIn()) {
      liff.login({ redirectUri: here });
      return;
    }
    if (!shareUrl) {
      alert("缺少 url 參數");
      return;
    }
    if (!liff.isInClient() || !liff.isApiAvailable("shareTargetPicker")) {
      alert("請在 LINE 內開啟此分享頁");
      return;
    }
    try {
      await liff.shareTargetPicker([
        { type: "text", text: `請分享給朋友\n${shareUrl}` },
      ]);
    } catch (e) {}
    if (liff.isInClient()) liff.closeWindow();
  })();
</script>
