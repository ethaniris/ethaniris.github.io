<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
  const LIFF_ID = "YOUR_LIFF_ID";
  const DEFAULT_SHARE_TEXT = "請分享給朋友\nhttps://example.com"; // ← put any test text or URL here

  (async () => {
    const here = location.href;
    const p = new URL(here).searchParams;
    // Use ?url=... if provided; otherwise fallback to DEFAULT_SHARE_TEXT
    const sharePayload = p.get("url") || DEFAULT_SHARE_TEXT;

    await liff.init({ liffId: LIFF_ID });
    if (!liff.isLoggedIn()) {
      liff.login({ redirectUri: here });
      return;
    }

    // Optional: also support sharing an image if ?img=... is given
    const img = p.get("img");

    if (!liff.isInClient() || !liff.isApiAvailable("shareTargetPicker")) {
      alert("請在 LINE 內開啟此分享頁");
      return;
    }

    try {
      const msgs = img
        ? [{ type: "image", originalContentUrl: img, previewImageUrl: img }]
        : [{ type: "text", text: sharePayload }];

      await liff.shareTargetPicker(msgs);
    } catch (e) {
      // user cancelled or error — ignore for test
    } finally {
      if (liff.isInClient()) liff.closeWindow();
    }
  })();
</script>
